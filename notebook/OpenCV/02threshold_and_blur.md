# 图像阈值与图像平滑

## 图像阈值

阈值函数

```python
ret, dst = cv2.threshold(src, thresh, maxval, type)
```

- 输入
	- `src`：原始输入的图片
	- `thresh`：阈值
	- `maxval`：当像素超过阈值/低于阈值，赋予的值（由`type`决定）
	- `type`:二值化操作的类型：
		- `cv2.THRESH_BINARY`
		- `cv2.THRESH_BINARY_INV`
		- `cv2.THRESH_TRUNC`
		- `cv2.THRESH_TOZERO`
		- `cv2.THRESH_TOZERO_INV`

| 类型         | 大于阈值     | 小于等于阈值   | 是否二值 |
|------------|----------|----------|------|
| BINARY     | `maxval` | `0`      | ✅    |
| BINARY_INV | `0`      | `maxval` | ✅    |
| TRUNC      | `thresh` | 原值       | ❌    |
| TOZERO     | 原值       | `0`      | ❌    |
| TOZERO_INV | `0`      | 原值       | ❌    |

- 输出
	- `res`:实际使用的阈值（float）
	- `dst`:阈值处理后的输出图像（ndarray）

## 图像平滑

#### 均值卷积平滑(Mean Blur)

均值滤波是一种最简单的线性平滑方法。对图像中每一个像素，用其邻域（由卷积核大小决定）内所有像素的平均值来替代当前像素，从而达到去噪、平滑的效果。

```python
blur = cv2.blur(src, ksize)
```

- 输入
	- `src`：原始输入的图片
	- `ksize`:卷积核大小，格式为 `(width, height)`
		- 核越大，平滑效果越强，但细节损失也越严重
- 输出
	- `blur`:阈值处理后的输出图像（ndarray）

#### 方框滤波(Box Filter)

与均值滤波相同，都是在局部邻域内对像素进行卷积运算。

_不同之处在于：方框滤波是否对卷积结果做归一化是可选的。_

```python
box = cv2.boxFilter(src, depth, ksize, normalize)
```

- 输入
	- `src`：原始输入的图片
	- `depth`:输出图像的深度（数据类型）
		- `-1`:输出与输入图像深度相同（最常用）
		- `cv2.CV_32F`、`cv2.CV_64F`：常用于防止求和溢出（normalize=False 时尤其重要）
	- `ksize`:卷积核大小，格式为 `(width, height)`
		- 核越大，平滑效果越强，但细节损失也越严重
	- `normalize`:是否对卷积结果进行归一化
		- `True`(默认):卷积结果除以核面积，等价于均值滤波（Mean Filter）
		- `Flase`：仅对邻域像素求和，不做平均；常用于积分图、特征计算等场景
- 输出
	- `box`:阈值处理后的输出图像（ndarray）

#### 高斯滤波(Gaussian Blur)

高斯滤波是一种加权平均滤波。
卷积核中的权值服从二维高斯分布，距离中心像素越近，权值越大；距离越远，权值越小。
因此相比均值滤波，高斯滤波能在平滑噪声的同时更好地保留边缘信息。

```python
gaussian = cv2.GaussianBlur(src, ksize, sigmaX)
```

- 输入
	- `src`：原始输入的图片
	- `ksize`:卷积核大小，格式为 `(width, height)`
		- 核越大，平滑效果越强，但细节损失也越严重
	- `sigmaX`:X 方向的高斯标准差
		- `sigmaX=0`:由 OpenCV 根据 `ksize` 自动计算
		- `sigmaX>0`:使用指定的标准差
- 输出
	- `gaussian`:阈值处理后的输出图像（ndarray）

#### 中值滤波（Median Blur）

使用卷积核覆盖范围内像素的**中值**替代中心像素，能够有效去除椒盐噪声，同时比均值滤波更好地保留边缘。

```python
median = cv2.medianBlur(src, ksize)
```

- 输入
	- `src`：原始输入图像
	- `ksize`：卷积核大小（必须为 **大于 1 的奇数**，如 `3、5、7`）
		- 核越大，平滑效果越强，但细节损失也越严重
- 输出
	- `median`：中值滤波后的图像（ndarray）

我们可以看一下三种滤波效果的比较

原始图片：

![](../../data/OpenCV-img/people.png)

滤波处理图片（分别是均值滤波， 高斯滤波， 中值滤波）：

![](../../artifacts/OpenCV/02threshold_and_blur/res_people.png)

_方框滤波在标准化后与均值滤波效果一致，故没有放入考虑_

# 总结

| 滤波方法                     | 核心思想                         | 主要用途                         | 优点                                 | 缺点                       | 是否保留边缘 |
|--------------------------|------------------------------|------------------------------|------------------------------------|--------------------------|--------|
| **均值滤波 (Mean Blur)**     | 用邻域像素的**平均值**替代中心像素          | 基础降噪、快速平滑图像                  | ✔ 实现简单<br>✔ 计算速度快                  | ❌ 容易造成图像模糊<br>❌ 边缘信息损失严重 | ❌ 较差   |
| **方框滤波 (Box Filter)**    | 对邻域求和再归一化（本质接近均值滤波，但可选择不归一化） | 快速图像平滑、积分图预处理                | ✔ 可控制是否归一化<br>✔ 计算效率高              | ❌ 模糊明显<br>❌ 对噪声类型不敏感     | ❌ 较差   |
| **高斯滤波 (Gaussian Blur)** | 按**高斯分布加权平均**，距离中心越近权重越大     | 去除**高斯噪声**、边缘检测前预处理（如 Canny） | ✔ 平滑自然<br>✔ 比均值更好地保留结构<br>✔ 很少产生伪影 | ❌ 仍会损失部分细节<br>❌ 计算量略高    | ⚠️ 中等  |
| **中值滤波 (Median Blur)**   | 用邻域像素的**中位数**替代中心像素          | 去除**椒盐噪声**（黑白随机噪点）           | ✔ 极强的脉冲噪声去除能力<br>✔ 边缘保持较好          | ❌ 计算较慢<br>❌ 对高斯噪声效果一般    | ✔ 较好   |

总而言之：

- 图像有随机亮度波动 → 高斯滤波
- 图像有黑白噪点 → 中值滤波（首选）
- 只想轻微平滑 + 要速度 → 均值 / 方框